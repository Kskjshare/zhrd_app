/// <reference path="jquery.min.js" />
/// <reference path="../data/dictdata.js" />
/// <reference path="rsseasy.min.js" />
/// <reference path="validated.v2.min.js" />
/// <reference path="rsseasy.app.js" />
/// <reference path="rsseasy.adapter.min.js" />
/// <reference path="rsseasy.weixin.js" />
/// <reference path="rsseasy.order.js" />


//生成HTML代码
var RssHtml = {}
RssHtml.KeyValueArr = {}
RssHtml.KeyValue = {}
RssHtml.Array = {}
RssHtml.KeyValueArr.Radio = function (data, opt) {
    var name = opt["name"] || "", value = opt["value"], text = opt["text"], html = "", wrap = opt["wrap"] || true;
    if (wrap) {
        $.each(data, function (idx, rows) {
            html += '<label for="' + name + rows[value] + '"><input type="radio" id="' + name + rows[value] + '" name="' + name + '" value="' + rows[value] + '" />' + rows[text] + '</label>'
        });
    } else {
        $.each(data, function (idx, rows) {
            html += '<input type="radio" id="' + name + rows[value] + '" name="' + name + '" value="' + rows[value] + '" /><label for="' + name + rows[value] + '">' + rows[text] + '</label>'
        });
    }
    return html;
}
RssHtml.KeyValue.Radio = function (data, opt) {
    var name = opt["name"] || "", html = "", wrap = opt["wrap"] || true;
    if (wrap) {
        $.each(data, function (key, text) {
            html += '<label for="' + name + key + '"><input type="radio" id="' + name + key + '" name="' + name + '" value="' + key + '" />' + text + '</label>'
        });
    }
    else {
        $.each(data, function (key, text) {
            html += '<input type="radio" id="' + name + key + '" name="' + name + '" value="' + key + '" /><label for="' + name + key + '">' + text + '</label>'
        });
    }
}

//转换关联到ID字段
RssHtml.TransId = function (json) {
    $.each(json, function (idx, rows) {
        rows["id"] = rows["relationid"];
    });
    return json;
}

//所有需要解析的数据
RssHtml.DataParse = RssDict.DataParse = {
    "provinceid": function (val) {
        return val ? AreaListData[val][0] : "";
    },
    "cityid": function (val) {
        return val ? AreaListData[val][0] : "";
    },
    "label": function (val) {
        if (!val) {
            return "";
        }
        val = val.split(",");
        var html = [];
        $.each(val, function (idx, val) {
            html.push('<li>#' + val + '#</li>');
        });
        return html.join("");
    },
    "schoolid": function (val) {
        return val ? dictdata.school[val] : "";
    },
    "eduid": function (val) {
        return dictdata.edu[val] || "";
    },
    "shijian": function (val) {
        return new Date(val * 1000).toString("yyyy-MM-dd");
    },
    "duration": function (val) {
        return new Date((parseInt(val) - 8 * 60 * 60) * 1000).toString("hh'mm'ss");
    }
}

//用户
RssHtml.User = function (wrap, json) {
    var data = json["data"] || json, attention = json["attentionitem"] || {};
    $.each(data, function (idx, rows) {
        rows["relationid"] = rows["myid"];
        rows["isattention"] = attention[rows["myid"]] ? 1 : 0;
    });
    wrap.mapview(data, this.DataParse);
}

//HTML绑定数据
RssHtml.BindData = function (wrap, json) {
    var data = json["data"] || json, attention = json["attentionitem"] || {}, user = json["useritem"] || {};
    wrap.mapview(data, this.DataParse);
}

RssHtml.Comment = function (comment, json) {
    var html = "", praiseitem = json["praiseitem"];
    $.each(json["data"], function (key, rows) {
        html += '<tr><td><div class="avatar"><img src="' + RssApp.UpHost + rows["avatar"] + '" /></div></td><td><h2>' + rows["realname"] + '</h2><div>' + rows["matter"] + '</div><h3><i>' + new Date(rows["shijian"] * 1000).toString("yyyy-MM-dd") + '</i><del>删除</del><b rsspraise="' + comment.Module + '_comment" relationid="' + rows["id"] + '" ispraise="' + (praiseitem[rows["id"]] ? 1 : 0) + '">' + (rows["praiseamount"] || 0) + '</b><b class="commentbtn" depend="' + comment.Module + 'comment"></b></h3></td></tr>';
    });
    comment.Wrap.html(html);
}